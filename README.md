# 股票估值分析系统

一个基于前后端分离架构的股票估值分析工具，支持自动获取股票数据并计算上市公司的合理市盈率和理论股价。

## 功能特性

- **估值计算**：基于Excel表格的戈登增长模型计算合理市盈率
- **自动数据获取**：集成多个股票数据API，自动获取实时股价和财务数据
- **股票管理**：支持添加、编辑、删除股票信息
- **批量分析**：自动计算所有股票的估值状态
- **筛选功能**：按市场、估值状态等条件筛选股票
- **数据导出**：支持CSV格式导出分析结果
- **多市场支持**：支持A股、H股、美股
- **定时更新**：每30分钟自动更新股票数据

## 技术架构

### 后端
- **框架**：FastAPI (Python)
- **数据库**：SQLite + SQLAlchemy
- **API**：RESTful API，根路径为 `/stock_api`
- **核心算法**：基于Excel表格的戈登增长模型
- **数据获取**：集成akshare、tushare等股票数据API
- **异步处理**：支持异步数据获取和定时任务

### 前端
- **框架**：React + TypeScript
- **UI组件**：Ant Design
- **路由**：React Router
- **HTTP客户端**：Axios

## 核心计算公式

基于Excel表格的计算逻辑：

```
1. EPS (每股收益) = 每股净资产 × ROE
2. 利润留存率 = 永续增长率 / ROE
3. 分红率 = 1 - 利润留存率
4. 每股分红 = EPS × 分红率
5. 内在价值 = 每股分红 / (要求回报率 - 永续增长率)
6. 合理市盈率 = 内在价值 / EPS
```

## 安装和运行

### 1. 克隆项目
```bash
git clone <repository-url>
cd stock_monitor
```

### 2. 后端设置
```bash
# 安装Python依赖
pip3 install -r requirements.txt

# 启动FastAPI服务
python3 -m uvicorn app:app --host 0.0.0.0 --port 5000 --reload
```

或者使用启动脚本：
```bash
chmod +x start_backend.sh
./start_backend.sh
```

后端服务将在 http://localhost:5000 启动

### 3. 前端设置
```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm start
```

前端应用将在 http://localhost:3000 启动

### 4. 一键启动
```bash
chmod +x start_all.sh
./start_all.sh
```

## API接口

### 基础路径
- 根路径：`/`
- API路径：`/stock_api`

### 主要接口
- `GET /stock_api/stocks` - 获取股票列表
- `POST /stock_api/stocks` - 创建新股票
- `PUT /stock_api/stocks/{id}` - 更新股票信息
- `DELETE /stock_api/stocks/{id}` - 删除股票
- `POST /stock_api/valuation/calculate` - 计算估值
- `GET /stock_api/analysis/screening` - 筛选分析
- `POST /stock_api/update/trigger` - 手动触发数据更新

## 数据自动获取

系统集成了多个股票数据API：

### akshare (主要)
- A股实时行情和财务数据
- 美股实时行情
- H股数据

### tushare (可选)
- 需要申请API Token
- 提供更全面的A股数据

### Alpha Vantage (可选)
- 美股数据补充
- 需要申请API Key

### 定时更新
- 每30分钟自动更新一次
- 支持手动触发更新
- 可配置是否自动更新特定股票

## 使用说明

### 1. 添加股票
- 在"股票管理"页面点击"添加股票"
- 填写股票基本信息（代码、名称、市场）
- 输入估值参数（每股净资产、ROE、永续增长率、要求回报率）
- 系统自动计算合理市盈率和理论股价

### 2. 估值分析
- 在"估值分析"页面查看所有股票的估值状态
- 使用筛选器按市场或估值状态筛选
- 查看PE偏差和价格偏差分析
- 导出分析结果到CSV文件

### 3. 估值计算器
- 在"估值计算器"页面输入参数进行单次计算
- 实时查看计算结果
- 了解计算公式和参数说明
- 支持填入示例数据进行测试

## 数据字段说明

### 股票基本信息
- **股票代码**：股票的唯一标识符
- **股票名称**：公司名称
- **市场**：A股/H股/美股

### 估值参数
- **每股净资产**：公司每股对应的净资产价值
- **ROE (净资产收益率)**：反映公司盈利能力，通常10%-30%
- **永续增长率**：长期可持续增长率，通常2%-6%
- **要求回报率**：投资者期望的最低回报率，通常8%-15%

### 计算结果
- **EPS**：每股收益
- **利润留存率**：公司留存利润的比例
- **分红率**：公司分红的比例
- **每股分红**：每股对应的分红金额
- **合理市盈率**：基于模型计算的理论市盈率
- **理论股价**：基于合理市盈率计算的理论股价

### 实时数据
- **当前股价**：实时市场价格
- **当前PE**：实时市盈率
- **市值**：公司总市值
- **成交量**：当日成交量
- **涨跌幅**：当日涨跌百分比

## 环境配置

复制 `env_example.txt` 为 `.env` 并配置：

```bash
# 股票数据API配置
TUSHARE_TOKEN=your_tushare_token_here
ALPHAVANTAGE_API_KEY=your_alphavantage_api_key_here

# 数据库配置
DATABASE_URL=sqlite:///./stock_valuation.db

# 服务器配置
HOST=0.0.0.0
PORT=5000
```

## 注意事项

1. **永续增长率必须小于要求回报率**，否则计算结果无效
2. **ROE数据**建议使用最近3-5年的平均值
3. **永续增长率**不宜设置过高，建议不超过6%
4. **要求回报率**可根据市场无风险利率和风险溢价调整
5. **API限制**：部分免费API有调用频率限制

## 扩展功能

### 数据自动获取
- 集成更多股票数据API
- 支持更多市场（港股、欧洲股市等）
- 历史数据回测功能

### 高级分析
- 行业对比分析
- 历史估值趋势
- 风险评估模型
- 投资组合优化

### 数据可视化
- 估值分布图表
- 行业估值对比
- 时间序列分析
- 交互式仪表板

## 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

## 许可证

MIT License
